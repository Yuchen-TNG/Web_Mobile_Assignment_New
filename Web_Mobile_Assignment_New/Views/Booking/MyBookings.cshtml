@model IEnumerable<Web_Mobile_Assignment_New.Models.Booking>

@{
    ViewBag.Title = "My Booking History";
}

@if (TempData["Message"] != null)
{
    var type = TempData["MessageType"]?.ToString() ?? "success";
    <div class="alert @(type == "success" ? "alert-success" : "alert-error")">
        @TempData["Message"]
    </div>
}

<style>
    /* 卡片整体样式 */
    body {
        font-family: "Segoe UI", Arial, sans-serif;
        background-color: #f9fafb;
        margin: 0;
    }

    .card-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .property-card {
        display: flex;
        flex-direction: row;
        background: #fff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        min-height: 200px;
        text-decoration: none;
        color: inherit;
		align-items: center;
    }

    .property-image {
        width: 400px;
		height: 277.1px;
        object-fit: contain;
        flex-shrink: 0;
    }

    .property-body {
        flex: 1;
        padding: 15px 20px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .property-title {
        font-size: 1.2rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 8px;
    }

    .property-price {
        font-size: 1.1rem;
        font-weight: bold;
        color: #2c7a7b;
        margin-bottom: 10px;
    }

    .property-info {
        font-size: 0.9rem;
        color: #555;
        margin: 4px 0;
    }

    /* 状态颜色 */
    .status-pending {
        color: #f59e0b;
        font-weight: bold;
    }

    .status-approved {
        color: #16a34a;
        font-weight: bold;
    }

    .status-rejected {
        color: #dc2626;
        font-weight: bold;
    }

    .status-completed {
        color: #6b7280;
        font-weight: bold;
    }

    /* 按钮样式 */
    .cancel-btn {
        margin-top: 15px;
        padding: 8px 15px;
        background: #dc2626;
        color: #fff;
        text-decoration: none;
        border-radius: 8px;
        font-size: 0.9rem;
        transition: background 0.2s ease, transform 0.2s ease;
        display: inline-block;
        width: fit-content;
    }

        .cancel-btn:hover {
            background: #b91c1c;
            transform: scale(1.05);
        }

    .receipt-btn {
        margin-top: 15px;
        padding: 8px 15px;
        background: #16a34a;
        color: #fff;
        text-decoration: none;
        border-radius: 8px;
        font-size: 0.9rem;
        transition: background 0.2s ease, transform 0.2s ease;
        display: inline-block;
        width: fit-content;
        border: none;
        cursor: pointer;
    }

        .receipt-btn:hover {
            background: #15803d;
            transform: scale(1.05);
        }

        .receipt-btn i {
            margin-right: 6px;
        }
</style>

<h2>My Booking History</h2>
<!-- Toast container -->
<div class="position-fixed top-0 start-50 translate-middle-x p-3" style="z-index: 1055;">
    <div id="bookingToast" class="toast align-items-center text-white bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                Are you sure you want to cancel this booking?
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>

<div id="bookingList">
    <!-- Ajax 会加载 _MyBookingsPartial -->
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Your existing loadPage and pagination code here
        function loadPage(page) {
            $.get('@Url.Action("MyBookingsPage", "Booking")', { page: page }, function (data) {
                $("#bookingList").html(data);
            });
        }

        $(document).ready(function() {
            loadPage(1); // initial load

            // Pagination click
            $(document).on("click", ".page-btn", function () {
                var page = $(this).data("page");
                loadPage(page);
            });

            // ========================
            // Confirmation toast logic
            var toastEl = document.getElementById('bookingToast');
            var toast = new bootstrap.Toast(toastEl);

                    $(document).on("click", ".btn-confirm", function () {
            var btn = $(this);
            var form = btn.closest("form");

            // Native confirmation dialog
            if (confirm("Are you sure you want to cancel this booking?")) {
                $.post(form.attr("action"), form.serialize(), function(res) {
                    // Reload current page
                    var currentPage = $(".page-btn.active").data("page") || 1;
                    loadPage(currentPage);

                    // Show result toast
                    var toastEl = document.getElementById('bookingToast');
                    var toast = new bootstrap.Toast(toastEl);

                    $("#bookingToast .toast-body").text(res.message);
                    toastEl.classList.remove("bg-success", "bg-danger");
                    toastEl.classList.add(res.success ? "bg-success" : "bg-danger");
                    toast.show();
                });
                }
            });

        });
    </script>
}


