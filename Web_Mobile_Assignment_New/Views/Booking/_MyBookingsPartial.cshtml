@model IEnumerable<Web_Mobile_Assignment_New.Models.Booking>

<div class="card-container">
    @foreach (var booking in Model)
    {
        <div class="property-card">
            @if (booking.House.Images != null && booking.House.Images.Any())
            {
                <img src="@booking.House.Images.First().ImageUrl"
                     alt="House Image"
                     class="property-image" />
            }
            else if (!string.IsNullOrEmpty(booking.House.ImageUrl))
            {
                <img src="@booking.House.ImageUrl"
                     alt="House Image"
                     class="property-image" />
            }
            else
            {
                <div class="d-flex align-items-center justify-content-center bg-light"
                     style="width:400px; height:200px;">
                    <span class="text-muted">No Image</span>
                </div>
            }
            <div class="property-body">
                <div class="property-title">@booking.House.RoomName (@booking.House.RoomType)</div>
                <div class="property-price">@booking.TotalPrice.ToString("C")</div>
                <div class="property-info">Start: @booking.StartDate.ToString("yyyy-MM-dd")</div>
                <div class="property-info">End: @booking.EndDate.ToString("yyyy-MM-dd")</div>
                <div class="property-info">Address: @booking.House.Address</div>

                @* Receipt 下载 *@
                @if (booking.Payment != null && booking.Payment.Status == "Completed")
                {
                    <a asp-action="Receipt"
                       asp-controller="Home"
                       asp-route-paymentId="@booking.Payment.PaymentId"
                       class="receipt-btn">
                        Download Receipt
                    </a>
                }

                @* Cancel Booking 按钮 *@
                @if (booking.EndDate >= DateTime.Today)
                {
                    <form asp-controller="Booking"
                          asp-action="CancelBooking"
                          asp-route-id="@booking.BookingId"
                          method="post"
                          class="cancel-booking-form">
                        <button type="button" class="cancel-btn btn-confirm">Cancel Booking</button>
                    </form>

                }
            </div>
        </div>
    }
</div>

<div class="pagination mt-3">
    @for (int i = 1; i <= ViewBag.TotalPages; i++)
    {
        <button class="btn btn-sm btn-outline-primary page-btn @(i == ViewBag.Page ? "active" : "")"
                data-page="@i">
            @i
        </button>
    }
</div>
